# 📖 Notifier — Telegram-лента на Pyrogram

## Описание
**Notifier** собирает посты из выбранных каналов и пересылает их в ваш главный канал-«лента». Основан на **Pyrogram**. Требует `api_id`/`api_hash` с сайта my.telegram.org. Команды отправляются с вашего аккаунта, поэтому авторизация проходит через сам Telegram-клиент при первом запуске. 

---

## Установка
1) Клонируйте репозиторий и перейдите в папку:
```bash
git clone https://github.com/ServChan/Notifier.git
cd Notifier
```
2) Установите зависимость:
```bash
pip install pyrogram
```
3) Заполните `config.py` значениями `api_id`, `api_hash`, `session_name`, `command_prefix`.
4) Запустите скрипт и пройдите авторизацию:
```bash
python main.py
```

---

## Настройка `config.py` (минимум)
```python
api_id = 123456
api_hash = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
session_name = "notifier_session"
command_prefix = ">"
```
- `api_id`/`api_hash` — возьмите на https://my.telegram.org/apps
- `session_name` — имя файла сессии (создастся автоматически)
- `command_prefix` — префикс команд, по умолчанию `>`

> В коде используется импорт `config`, а дальше обращения `config.session_name`, `config.api_id`, `config.api_hash`, `config.command_prefix` — убедитесь, что поля названы ровно так.

---

## Первичная настройка ленты
1) Создайте **новый канал** и отправьте туда команду:
```
>setmainchannel
```
Теперь этот канал — ваша «лента».  
2) Чтобы **добавить источник** (любой канал) в ленту: **перешлите** его пост в любой чат и **ответьте** на пересланное сообщение командой:
```
>addchannel
```
3) Чтобы **удалить** канал из ленты: перешлите его пост и ответьте командой:
```
>removechannel
```
4) Чтобы посмотреть список подключённых каналов:
```
>list
```

---

## Как это работает (внутри)
- База `Notifier.db` (SQLite) хранит:
  - `settings(notifychannel_id)` — id главного канала-ленты
  - `channels(channel_id)` — список каналов-источников
- На каждое новое сообщение **в канале-источнике** скрипт проверяет, подключён ли он в таблице `channels` и, если да, пересылает пост в `notifychannel_id`.
- Скрипт написан на **Pyrogram** и использует API вашего аккаунта (не бот-токен).

> Репозиторий уже содержит файл `Notifier.db`. Если запускаете «с нуля» и файл отсутствует, он будет создан автоматически, но **таблицы** удобнее подготовить вручную (см. ниже SQL).

---

## SQL-схема (если нужна ручная инициализация)
```sql
CREATE TABLE IF NOT EXISTS settings (
  notifychannel_id INTEGER
);

CREATE TABLE IF NOT EXISTS channels (
  channel_id INTEGER PRIMARY KEY
);
```
После создания таблиц выполните команду `>setmainchannel` в канале-ленте, чтобы заполнить `settings` актуальным id.

---

## Регулярные выражения (опционально)
В `main.py` предусмотрены заготовки для **REGEX-фильтров** (по упоминанию вашего `@username` или никнейма). Они закомментированы — раскомментируйте нужные хендлеры в блоках «REGEX фильтры». Это позволит ловить, например, упоминания вашего ника в любых чатах и пересылать в ленту.

Примеры шаблонов:
- Любое упоминание слова: `.*СЛОВО.*`
- Невзирая на регистр: `[Ss]erver` поймает `Server` и `server`
- Несколько вариантов через `|`: `.*(ServerChan|Server-chan).*`

---

## Команды (по умолчанию с префиксом `>`)
- `setmainchannel` — сделать текущий канал «лентой»
- `addchannel` — добавить пересланный канал-источник в ленту
- `removechannel` — удалить пересланный канал-источник из ленты
- `list` — показать список подключённых каналов

> В `main.py` также заданы русские алиасы: `добавитьканал`, `удалитьканал`, `список`.

---

## Типичные сценарии
- Собрать персональную новостную ленту из 5–10 каналов в один «тихий» канал без комментариев.
- Подготовить мониторинг изменений в тематических источниках и просматривать всё из одного места.
- Включить REGEX и получать пинги, когда в чатах упоминают ваш ник/аккаунт.

---

## Частые вопросы
**Нужны ли права администратора?**  
— В канале-ленте права не требуются, вы пишете команду от своего аккаунта. Для пересылки сообщений из других каналов достаточно, чтобы канал был публичным или чтобы вы имели право видеть его сообщения.

**Можно ли настроить префикс команд?**  
— Да, в `config.py` через `command_prefix`.

**Почему пересылка не работает для некоторых каналов?**  
— Если канал закрытый и ваш аккаунт не имеет доступа, пересылка невозможна.

---

## Минимальный пример запуска
```bash
pip install pyrogram
# заполните config.py
python main.py
# откройте свой канал-ленту и отправьте >setmainchannel
# перешлите пост из любого источника и ответьте на него >addchannel
```
